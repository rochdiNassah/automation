#!/usr/bin/env php
<?php declare(strict_types=1);

require './vendor/autoload.php';

use Automation\Framework\Application;
use Automation\Framework\Facades\Slack;

Application::instance()->run();

$sleep_for = (int) config('DAEMON_SLEEP_FOR');

if (false === ($message = Slack::channel('debug')->send('Automation daemon has started!'))) {
    throw new Exception('Unable to notify that the daemon has started!');
}

dump('Notification sent!');

sleep(4);

Slack::delete($message);

dump('Notification deleted!');

while (true) {
    sleep($sleep_for);
}